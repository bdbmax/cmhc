<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Under Construction â€¢ cmhc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Under Construction">
<meta property="og:description" content="cmhc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmhc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Unabsorbed.html">Unabsorbed Stock</a>
    </li>
    <li>
      <a href="../articles/Under%20Construction.html">Under Construction</a>
    </li>
    <li>
      <a href="../articles/rental_construction.html">Rental Under Construction</a>
    </li>
    <li>
      <a href="../articles/timelines.html">Time Lines</a>
    </li>
    <li>
      <a href="../articles/vacancy_vs_rent_change.html">Vacancy Rates and Rent Changes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Under%20Construction_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Under Construction</h1>
                        <h4 class="author">Jens von Bergmann</h4>
            
            <h4 class="date">2017-08-29</h4>
      
      
      <div class="hidden name"><code>Under Construction.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates how to pull in under construction data from CMHC using the <code>cmhc</code> package, link it with geographic data from <a href="https://censusmapper.ca">CensusMapper</a> using the <code>cancensus</code> package and map the under construction data. ## CMHC data</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#devtools::install_github("mountainmath/cmhc")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cmhc</span><span class="op">)</span>

<span class="va">cma</span><span class="op">=</span><span class="st">"Montreal"</span>
<span class="va">year</span><span class="op">=</span><span class="fl">2018</span>
<span class="va">month</span><span class="op">=</span><span class="fl">07</span>


<span class="va">census_cma</span><span class="op">=</span><span class="va">census_geography_list</span><span class="op">[[</span><span class="va">cma</span><span class="op">]</span><span class="op">]</span>
<span class="va">cma_header</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">census_cma</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">census_cma</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">census_cma</span><span class="op">)</span><span class="op">)</span>

<span class="co">#get all under construction data for Vancouver and pad CT GeoUIDs.</span>
<span class="va">under_construction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cmhc.html">get_cmhc</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/cmhc_snapshot_params.html">cmhc_snapshot_params</a></span><span class="op">(</span>
    table_id <span class="op">=</span> <span class="va">cmhc_table_list</span><span class="op">[</span><span class="st">"Scss Under Construction CT"</span><span class="op">]</span>,
    breakdown_geography_type<span class="op">=</span><span class="st">"CT"</span>,
    geography_id <span class="op">=</span> <span class="va">cmhc_geography_list</span><span class="op">[[</span><span class="va">cma</span><span class="op">]</span><span class="op">]</span>,
    year <span class="op">=</span> <span class="va">year</span>,
    month <span class="op">=</span> <span class="va">month</span><span class="op">)</span><span class="op">)</span>

<span class="va">under_construction</span> <span class="op">&lt;-</span> <span class="va">under_construction</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>GeoUID <span class="op">=</span> <span class="fu"><a href="../reference/cmhc_geo_uid_for_ct.html">cmhc_geo_uid_for_ct</a></span><span class="op">(</span><span class="va">cma_header</span>,<span class="va">X1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="geographic-data" class="section level2">
<h2 class="hasAnchor">
<a href="#geographic-data" class="anchor"></a>Geographic data</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mountainMath/cancensus">cancensus</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span>
<span class="co">#options(cancensus.api_key='your API key')</span>
<span class="va">geos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mountainmath.github.io/cancensus/index.html/reference/get_census.html">get_census</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'CA16'</span>, regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>CMA<span class="op">=</span><span class="va">census_cma</span><span class="op">)</span>,level<span class="op">=</span><span class="st">'CT'</span>,geo_format<span class="op">=</span><span class="st">'sf'</span><span class="op">)</span></code></pre></div>
</div>
<div id="joining-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#joining-the-data" class="anchor"></a>Joining the data</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">geos</span>,<span class="va">under_construction</span>, by<span class="op">=</span><span class="st">"GeoUID"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="graph" class="section level2">
<h2 class="hasAnchor">
<a href="#graph" class="anchor"></a>Graph</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bg_color</span><span class="op">=</span><span class="st">"#c0c0c0"</span>
<span class="va">theme_opts</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       <span class="co">#panel.grid.major = element_blank(), #bug, not working</span>
                       panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">bg_color</span><span class="op">)</span>,
                       panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bg_color</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
                       plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">bg_color</span>, size<span class="op">=</span><span class="fl">1</span>,linetype<span class="op">=</span><span class="st">"solid"</span><span class="op">)</span>,
                       axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>After defining a basic theme we can go ahead and map the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">breaks</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">1</span>,<span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">100</span>,<span class="fl">250</span>,<span class="fl">500</span>,<span class="fl">750</span>,<span class="fl">1000</span>,<span class="fl">2000</span>,<span class="cn">Inf</span><span class="op">)</span>
<span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"0 - "</span>,<span class="va">breaks</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">labels</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">breaks</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, sep<span class="op">=</span><span class="st">" - "</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">labels</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Over "</span>,<span class="va">breaks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#colors=c("darkred",(RColorBrewer::brewer.pal(length(labels)-1,"YlGnBu")))</span>
<span class="va">labels</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">labels</span>, levels<span class="op">=</span><span class="va">labels</span><span class="op">)</span>
<span class="va">colors</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#808080"</span>,<span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"PiYG"</span><span class="op">)</span><span class="op">)</span>,<span class="va">labels</span><span class="op">)</span>
<span class="co">#colors=factor(as.character(colors),levels=as.character(colors))</span>

<span class="co"># categorize the numbers under contruction</span>
<span class="va">geos</span><span class="op">$</span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="va">geos</span><span class="op">$</span><span class="va">All</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="va">breaks</span>, labels<span class="op">=</span><span class="va">labels</span><span class="op">)</span>
<span class="va">total</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">geos</span><span class="op">$</span><span class="va">All</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">geos</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">categories</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>labels<span class="op">=</span><span class="va">labels</span>, values<span class="op">=</span><span class="va">colors</span>, name <span class="op">=</span> <span class="st">"# Units"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">cma</span>, <span class="st">" CMA Under Construction "</span>,<span class="va">month</span>,<span class="st">"-"</span>,<span class="va">year</span>,<span class="st">" ("</span>,<span class="fu"><a href="https://rdrr.io/r/base/formatc.html">prettyNum</a></span><span class="op">(</span><span class="va">total</span>,big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>,<span class="st">" total)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">theme_opts</span></code></pre></div>
<p><img src="Under%20Construction_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">'images'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">'images'</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">'images'</span><span class="op">)</span>,<span class="st">'/under_construction_'</span>,<span class="va">cma</span>,<span class="st">'_'</span>,<span class="va">year</span>,<span class="st">'_'</span>,<span class="va">month</span>,<span class="st">'.png'</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">10</span>,height<span class="op">=</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
</div>
<div id="mixing-with-census-data" class="section level2">
<h2 class="hasAnchor">
<a href="#mixing-with-census-data" class="anchor"></a>Mixing with Census Data</h2>
<p>We can also mix in census data. For example we can show the construction activity relative to the 2016 dwelling stock.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geos</span><span class="op">$</span><span class="va">relative_activity</span> <span class="op">&lt;-</span> <span class="va">geos</span><span class="op">$</span><span class="va">All</span> <span class="op">/</span> <span class="va">geos</span><span class="op">$</span><span class="va">Dwellings</span> 
<span class="va">relative_total</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">geos</span><span class="op">$</span><span class="va">All</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">geos</span><span class="op">$</span><span class="va">Dwellings</span><span class="op">)</span>
<span class="va">relative_breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">0.001</span>,<span class="fl">0.0025</span>,<span class="fl">0.005</span>,<span class="fl">0.0075</span>,<span class="fl">0.01</span>,<span class="fl">0.015</span>,<span class="fl">0.025</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="cn">Inf</span><span class="op">)</span>

<span class="va">relative_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"0 - "</span>,<span class="fu"><a href="https://rdrr.io/r/base/formatc.html">prettyNum</a></span><span class="op">(</span><span class="va">relative_breaks</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fl">10000</span>,big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">relative_breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">relative_labels</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html">prettyNum</a></span><span class="op">(</span><span class="va">relative_breaks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="fl">10000</span>,big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>, <span class="st">" - "</span>,<span class="fu"><a href="https://rdrr.io/r/base/formatc.html">prettyNum</a></span><span class="op">(</span><span class="va">relative_breaks</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">10000</span>,big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">relative_labels</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">relative_breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Over "</span>,<span class="fu"><a href="https://rdrr.io/r/base/formatc.html">prettyNum</a></span><span class="op">(</span><span class="va">relative_breaks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">relative_breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">10000</span>,big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span>
<span class="va">relative_colors</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">relative_labels</span><span class="op">)</span>,<span class="st">"RdYlGn"</span><span class="op">)</span>,<span class="va">relative_labels</span><span class="op">)</span>

<span class="va">geos</span><span class="op">$</span><span class="va">relative_categories</span> <span class="op">&lt;-</span> <span class="va">geos</span><span class="op">$</span><span class="va">relative_activity</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="va">relative_breaks</span>, labels<span class="op">=</span><span class="va">relative_labels</span><span class="op">)</span>

<span class="va">title</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">cma</span>, <span class="st">" CMA Under Construction "</span>,<span class="va">month</span>,<span class="st">"-"</span>,<span class="va">year</span>,
             <span class="st">" per 10,000 existing dwellings  ("</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/formatc.html">prettyNum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">relative_total</span><span class="op">*</span><span class="fl">10000</span><span class="op">)</span>,big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>,
             <span class="st">" on average)"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">geos</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">relative_categories</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>labels<span class="op">=</span><span class="va">relative_labels</span>, values<span class="op">=</span><span class="va">relative_colors</span>, name <span class="op">=</span> <span class="st">"# Units per 10k\nExisting 2016"</span>,na.value<span class="op">=</span><span class="st">"#808080"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">theme_opts</span></code></pre></div>
<p><img src="Under%20Construction_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">'images'</span><span class="op">)</span>,<span class="st">'/rel_under_construction_'</span>,<span class="va">cma</span>,<span class="st">'_'</span>,<span class="va">year</span>,<span class="st">'_'</span>,<span class="va">month</span>,<span class="st">'.png'</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">10</span>,height<span class="op">=</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>We could also just as easily choose other census variables to try and understand why dwelling unit construction is higher in some areas than in others. For example.</p>
</div>
<div id="annex" class="section level2">
<h2 class="hasAnchor">
<a href="#annex" class="anchor"></a>Annex</h2>
<p>Everyone seems to be talking about this area called the Annex these days. Letâ€™s check whatâ€™s under development there right now, so letâ€™s zoom in a bit and overlay the neighbourhood boundary. While most of the Annex has essentially zero development happening right now, the north-eastern corner that also holds the subject site that irks everyoneâ€™s interest these days does seems to see some moderate development activity. It is also evident that the development activity is spread very unevenly, and some areas are recieving an order of magnitude more active development.</p>
<p>Lastly, letâ€™s check exactly how many units are under construction in the Annex. The Annex is covered by 3 CTs, so this is quite easy. Some of the construction might be outside of the Annex, the sliver on the north side of Dupond Street and south of the railroad tracks. But this gives a simple upper bound.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">annex_cts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"5350092.00"</span>,<span class="st">"5350091.01"</span>,<span class="st">"5350091.02"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">geos</span><span class="op">$</span><span class="va">All</span><span class="op">[</span><span class="va">geos</span><span class="op">$</span><span class="va">GeoUID</span> <span class="op">%in%</span> <span class="va">annex_cts</span><span class="op">]</span><span class="op">)</span>, <span class="st">" units under construction in the Annex"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "0 units under construction in the Annex"</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bg_color</span><span class="op">=</span><span class="st">"#c0c0c0"</span>
<span class="va">theme_opts</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       <span class="co">#panel.grid.major = element_blank(), #bug, not working</span>
                       panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">bg_color</span><span class="op">)</span>,
                       panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bg_color</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,
                       plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">bg_color</span>, size<span class="op">=</span><span class="fl">1</span>,linetype<span class="op">=</span><span class="st">"solid"</span><span class="op">)</span>,
                       axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                       axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>


<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cmhc</span><span class="op">)</span>
<span class="va">cma</span><span class="op">=</span><span class="st">"Victoria"</span>
<span class="va">year</span><span class="op">=</span><span class="fl">2017</span>
<span class="va">month</span><span class="op">=</span><span class="fl">10</span>

<span class="va">census_cma</span><span class="op">=</span><span class="va">census_geography_list</span><span class="op">[[</span><span class="va">cma</span><span class="op">]</span><span class="op">]</span>
<span class="va">cma_header</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">census_cma</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">census_cma</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">census_cma</span><span class="op">)</span><span class="op">)</span>


<span class="va">census_cma</span><span class="op">=</span><span class="va">census_geography_list</span><span class="op">[[</span><span class="va">cma</span><span class="op">]</span><span class="op">]</span>
<span class="va">cma_header</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">census_cma</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">census_cma</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">census_cma</span><span class="op">)</span><span class="op">)</span>

<span class="co">#get all under construction data for Vancouver and pad CT GeoUIDs.</span>

<span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">'2016-05-01'</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2017-10-01"</span><span class="op">)</span>,by<span class="op">=</span><span class="st">'months'</span> <span class="op">)</span>


<span class="va">completions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">dates</span>,<span class="kw">function</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">{</span>
  <span class="va">month</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span><span class="va">date</span>,format<span class="op">=</span><span class="st">"%m"</span><span class="op">)</span>
  <span class="va">year</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span><span class="va">date</span>,format<span class="op">=</span><span class="st">"%Y"</span><span class="op">)</span>
  <span class="va">c</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_cmhc.html">get_cmhc</a></span><span class="op">(</span><span class="fu"><a href="../reference/cmhc_snapshot_params.html">cmhc_snapshot_params</a></span><span class="op">(</span>
  table_id<span class="op">=</span><span class="va">cmhc_table_list</span><span class="op">[</span><span class="st">"Scss Completions CT"</span><span class="op">]</span>,
  geography_id <span class="op">=</span> <span class="va">cmhc_geography_list</span><span class="op">[[</span><span class="va">cma</span><span class="op">]</span><span class="op">]</span>,
  year <span class="op">=</span> <span class="va">year</span>,
  month <span class="op">=</span> <span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>GeoUID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">cma_header</span>,<span class="va">X1</span><span class="op">)</span>,
         date<span class="op">=</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">X1</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">date</span>,<span class="op">-</span><span class="va">`Census geography`</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GeoUID</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span>

<span class="va">geos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mountainmath.github.io/cancensus/index.html/reference/get_census.html">get_census</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">'CA16'</span>, regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>CMA<span class="op">=</span><span class="va">census_cma</span><span class="op">)</span>,level<span class="op">=</span><span class="st">'CT'</span>,geo_format<span class="op">=</span><span class="st">'sf'</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">completions</span>, by<span class="op">=</span><span class="st">"GeoUID"</span><span class="op">)</span></code></pre></div>
<pre><code>## Reading geo data from local cache.</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">breaks</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">1</span>,<span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">100</span>,<span class="fl">150</span>,<span class="fl">200</span>,<span class="fl">250</span>,<span class="fl">300</span>,<span class="fl">400</span>,<span class="cn">Inf</span><span class="op">)</span>
<span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"0 - "</span>,<span class="va">breaks</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">labels</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">breaks</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, sep<span class="op">=</span><span class="st">" - "</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">labels</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Over "</span>,<span class="va">breaks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#colors=c("darkred",(RColorBrewer::brewer.pal(length(labels)-1,"YlGnBu")))</span>
<span class="va">labels</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">labels</span>, levels<span class="op">=</span><span class="va">labels</span><span class="op">)</span>
<span class="va">colors</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#808080"</span>,<span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">labels</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>,<span class="st">"PiYG"</span><span class="op">)</span><span class="op">)</span>,<span class="va">labels</span><span class="op">)</span>
<span class="co">#colors=factor(as.character(colors),levels=as.character(colors))</span>

<span class="co"># categorize the numbers under contruction</span>
<span class="va">geos</span><span class="op">$</span><span class="va">categories</span> <span class="op">&lt;-</span> <span class="va">geos</span><span class="op">$</span><span class="va">All</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="va">breaks</span>, labels<span class="op">=</span><span class="va">labels</span><span class="op">)</span>
<span class="va">total</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">geos</span><span class="op">$</span><span class="va">All</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">geos</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">categories</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>labels<span class="op">=</span><span class="va">labels</span>, values<span class="op">=</span><span class="va">colors</span>, name <span class="op">=</span> <span class="st">"# Units"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">cma</span>, <span class="st">" CMA Completions "</span>,<span class="va">month</span>,<span class="st">"-"</span>,<span class="va">year</span>,<span class="st">" ("</span>,<span class="fu"><a href="https://rdrr.io/r/base/formatc.html">prettyNum</a></span><span class="op">(</span><span class="va">total</span>,big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>,<span class="st">" total)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">theme_opts</span></code></pre></div>
<p><img src="Under%20Construction_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
